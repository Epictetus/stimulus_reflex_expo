<div id="<%= room %>" data-room="<%= room %>" data-controller="chat" data-action="chats:added@document->chat#reload cable-ready:after-morph@document->chat#scroll"
  class="<%= css "tab-pane bg-white p-4 border border-top-0", "show active": active_chat_room?(room) %>">
  <div data-target="chat.list" class="border rounded mb-2 p-3 <%= chat_border_css room %>" style="height:400px; max-width:800px; overflow-y:scroll;">
    <% @chats.select { |chat| chat[:room] == room }.each do |chat| %>
      <% if chat_author? chat %>
        <div class="<%= chat_css room %> rounded-pill border my-2 p-2 pl-3 pr-3 text-right w-75 float-right">
          <%= chat[:message] %>
          <small class="opacity-30 d-block">~me <%= distance_of_time_in_words_to_now Time.parse(chat[:created_at]) %> ago</small>
        </div>
      <% else %>
        <div class="bg-light rounded-pill border my-2 p-2 pl-3 pr-3 text-left w-75 float-left">
          <%= chat[:message] %>
          <small class="opacity-30 d-block">~<%= session.id[0,6] %> <%= distance_of_time_in_words_to_now Time.parse(chat[:created_at]) %> ago</small>
        </div>
      <% end %>
    <% end %>
  </div>
  <form style="max-width:800px;">
    <div class="form-group">
      <textarea data-target="chat.input" class="form-control border <%= chat_border_css room %>" rows="3" placeholder="Type your message..."></textarea>
    </div>
    <button data-action="click->chat#post" type="submit" class="btn btn-primary">Submit</button>
  </form>
</div>
